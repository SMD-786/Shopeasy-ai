<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text-to-Speech Generator (Offline)</title>
    <style>
        /* --- Global Styles & Reset --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
             scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
                Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue',
                sans-serif;
            background-color: #f0f4f8; /* Light background */
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        /* --- Main Container --- */
        .tts-container {
            background-color: #ffffff;
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 700px;
            text-align: center;
        }

        /* --- Typography --- */
        h1 {
            color: #2c3e50; /* Dark blue-grey */
            margin-bottom: 15px;
            font-weight: 600;
        }

        .instructions {
            color: #555;
            margin-bottom: 25px;
            font-size: 0.95em;
        }
        .instructions strong {
            color: #e74c3c; /* Highlight limitations */
        }

        /* --- Text Area --- */
        textarea#textInput {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 1px solid #dcdfe6; /* Light grey border */
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 20px;
            resize: vertical;
            line-height: 1.5;
            color: #444;
            background-color: #fdfdfd;
        }
         textarea#textInput:focus {
            outline: none;
            border-color: #4a90e2; /* Highlight blue */
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
         }
         textarea#textInput:disabled {
            background-color: #f5f7fa;
            cursor: not-allowed;
         }


        /* --- Controls Area --- */
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); /* Responsive grid */
            gap: 20px;
            margin-bottom: 25px;
            text-align: left; /* Align labels left */
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        .control-group label {
            font-weight: 500;
            margin-bottom: 8px;
            color: #4a4a4a;
            font-size: 0.9em;
        }
        .control-group label[disabled] {
             color: #aaa; /* Grey out label when disabled */
        }


        /* --- Dropdown Select --- */
         select#voiceSelect {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #dcdfe6;
            border-radius: 6px;
            background-color: #fff;
            cursor: pointer;
            font-size: 0.95em;
            appearance: none; /* Remove default appearance */
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23AAAAAA%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 10px;
            grid-column: span 2; /* Make dropdown wider in grid */
        }
         select#voiceSelect:focus {
             outline: none;
             border-color: #4a90e2;
             box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
         }
         select#voiceSelect:disabled {
            background-color: #f5f7fa;
            color: #aaa;
            cursor: not-allowed;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23CCCCCC%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'); /* Grey arrow */
         }

        /* --- Sliders --- */
        input[type='range'] {
            width: 100%;
            cursor: pointer;
            appearance: none;
            height: 8px;
            background: #e2e8f0; /* Light track */
            border-radius: 5px;
            outline: none;
            margin-top: 5px; /* Space between label and slider */
            transition: background 0.2s ease-in-out;
        }
        input[type='range']:disabled {
            background: #ebeff5;
            cursor: not-allowed;
        }

        input[type='range']::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            background: #4a90e2; /* Blue thumb */
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.2s ease-in-out;
        }
        input[type='range']:disabled::-webkit-slider-thumb {
            background: #b8c6d6; /* Grey thumb when disabled */
             cursor: not-allowed;
        }
        input[type='range']::-moz-range-thumb {
             width: 16px;
             height: 16px;
             background: #4a90e2;
             border-radius: 50%;
             border: none;
             cursor: pointer;
             transition: background 0.2s ease-in-out;
        }
         input[type='range']:disabled::-moz-range-thumb {
             background: #b8c6d6;
             cursor: not-allowed;
         }

        input[type='range']::-webkit-slider-thumb:hover {
            background: #357abd; /* Darker blue on hover */
        }
         input[type='range']::-moz-range-thumb:hover {
             background: #357abd;
         }
         input[type='range']:disabled::-webkit-slider-thumb:hover,
         input[type='range']:disabled::-moz-range-thumb:hover {
              background: #b8c6d6; /* No hover effect when disabled */
         }

        .slider-value {
            font-size: 0.85em;
            color: #666;
            margin-left: 5px; /* Space value next to label */
            display: inline-block; /* Ensure span takes space */
            min-width: 20px; /* Prevent layout shifts */
        }
        label[disabled] .slider-value {
            color: #aaa; /* Grey out value when disabled */
        }


        /* --- Action Buttons --- */
        .action-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap; /* Allow wrapping on small screens */
            gap: 15px;
            margin-top: 10px;
        }

        .action-buttons button {
            padding: 12px 25px;
            font-size: 1rem;
            font-weight: 500;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
        }
        .action-buttons button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }


        #playBtn { background-color: #2ecc71; color: white; } /* Green */
        #playBtn:hover:not(:disabled) { background-color: #27ae60; transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0,0,0,0.1);}

        #pauseBtn { background-color: #f39c12; color: white; } /* Orange */
        #pauseBtn:hover:not(:disabled) { background-color: #e67e22; transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0,0,0,0.1);}

        #resumeBtn { background-color: #3498db; color: white; } /* Blue */
        #resumeBtn:hover:not(:disabled) { background-color: #2980b9; transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0,0,0,0.1);}

        #stopBtn { background-color: #e74c3c; color: white; } /* Red */
        #stopBtn:hover:not(:disabled) { background-color: #c0392b; transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0,0,0,0.1);}


        /* --- Status Message --- */
        #status {
            margin-top: 25px;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.9em;
            color: #555;
            min-height: 1.5em; /* Prevent layout shifts */
            font-style: italic;
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
        #status.loading {
            color: #007bff; /* Blue for loading */
            border-color: #b8daff;
             background-color: #e7f3ff;
             font-weight: 500;
        }
        #status.speaking {
            color: #28a745; /* Green for speaking */
             border-color: #c3e6cb;
             background-color: #e2f0e6;
             font-weight: 500;
        }
        #status.paused {
            color: #ffc107; /* Yellow for paused */
            border-color: #ffeeba;
            background-color: #fff8e7;
             font-weight: 500;
        }
        #status.error {
            color: #dc3545; /* Red for errors */
            border-color: #f5c6cb;
            background-color: #fbecef;
            font-weight: bold;
        }
        #status.ready {
            color: #17a2b8; /* Teal for ready */
            border-color: #bee5eb;
            background-color: #e1f5f8;
             font-weight: 500;
        }

        /* --- Responsive Design --- */
        @media (max-width: 600px) {
            .tts-container {
                padding: 20px;
            }
            h1 {
                font-size: 1.5em;
            }
             .controls {
                 grid-template-columns: 1fr; /* Stack controls */
                 gap: 15px;
            }
            select#voiceSelect {
                 grid-column: span 1; /* Reset span */
            }
            .action-buttons {
                gap: 10px;
            }
             .action-buttons button {
                 padding: 10px 20px;
                 font-size: 0.9rem;
                 flex-grow: 1; /* Allow buttons to grow */
                 min-width: 80px;
             }
        }
         @media (max-width: 400px) {
            .action-buttons {
                flex-direction: column; /* Stack buttons vertically */
                align-items: stretch; /* Make buttons full width */
            }
         }

    </style>
</head>
<body>

    <div class="tts-container">
        <h1>Text-to-Speech Generator</h1>
        <p class="instructions">
            Enter text, select an available voice (Hindi/English depends on your system), adjust settings, and Play.
            <br>
            <strong>Note:</strong> Direct MP3 download is not possible with this browser-based tool due to Web Speech API limitations.
        </p>

        <textarea id="textInput" placeholder="Type or paste your text here..." disabled></textarea>

        <div class="controls">
            <div class="control-group">
                <label for="voiceSelect" id="voiceSelectLabel" disabled>Select Voice:</label>
                <select id="voiceSelect" disabled>
                    <option value="">Loading voices...</option>
                    <!-- Voices populated by JavaScript -->
                </select>
            </div>

            <div class="control-group">
                <label for="rateSlider" id="rateLabel" disabled>Rate: <span id="rateValue" class="slider-value">1</span></label>
                <input type="range" id="rateSlider" min="0.5" max="2" value="1" step="0.1" disabled>
            </div>

            <div class="control-group">
                <label for="pitchSlider" id="pitchLabel" disabled>Pitch: <span id="pitchValue" class="slider-value">1</span></label>
                <input type="range" id="pitchSlider" min="0" max="2" value="1" step="0.1" disabled>
            </div>

             <div class="control-group">
                <label for="volumeSlider" id="volumeLabel" disabled>Volume: <span id="volumeValue" class="slider-value">1</span></label>
                <input type="range" id="volumeSlider" min="0" max="1" value="1" step="0.1" disabled>
            </div>
        </div>

        <div class="action-buttons">
            <button id="playBtn" disabled>Play</button>
            <button id="pauseBtn" disabled>Pause</button>
            <button id="resumeBtn" disabled>Resume</button>
            <button id="stopBtn" disabled>Stop</button>
        </div>

        <p id="status">Initializing...</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Check for Web Speech API support early
            if (!('speechSynthesis' in window) || !('SpeechSynthesisUtterance' in window)) {
                updateStatus('Sorry, your browser does not support the Web Speech API. Try a modern browser like Chrome, Firefox, Edge, or Safari.', true);
                disableAllControls(); // Keep everything disabled
                return;
            }

            const synth = window.speechSynthesis;

            // --- DOM Elements ---
            const textInput = document.getElementById('textInput');
            const voiceSelect = document.getElementById('voiceSelect');
            const voiceSelectLabel = document.getElementById('voiceSelectLabel');
            const rateSlider = document.getElementById('rateSlider');
            const rateValueSpan = document.getElementById('rateValue');
            const rateLabel = document.getElementById('rateLabel');
            const pitchSlider = document.getElementById('pitchSlider');
            const pitchValueSpan = document.getElementById('pitchValue');
            const pitchLabel = document.getElementById('pitchLabel');
            const volumeSlider = document.getElementById('volumeSlider');
            const volumeValueSpan = document.getElementById('volumeValue');
            const volumeLabel = document.getElementById('volumeLabel');
            const playBtn = document.getElementById('playBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const resumeBtn = document.getElementById('resumeBtn');
            const stopBtn = document.getElementById('stopBtn');
            const status = document.getElementById('status');

            let voices = [];
            let currentUtterance = null;
            let voiceLoadTimeout; // To handle browsers that don't fire 'voiceschanged' reliably

            // --- Voice Loading Logic ---
            function populateVoiceList() {
                clearTimeout(voiceLoadTimeout); // Clear fallback timer
                voices = synth.getVoices();
                console.log(`Found ${voices.length} voices.`);

                // Sometimes voiceschanged fires but getVoices() is still empty, try again shortly
                if (voices.length === 0 && synth.onvoiceschanged !== undefined) {
                     console.warn("voiceschanged fired but getVoices() returned empty. Retrying shortly...");
                     voiceLoadTimeout = setTimeout(populateVoiceList, 250); // Retry after a short delay
                     return;
                }

                const previouslySelected = voiceSelect.value;
                voiceSelect.innerHTML = ''; // Clear existing options

                if (voices.length === 0) {
                    voiceSelect.innerHTML = '<option value="">No voices available</option>';
                    updateStatus('No speech synthesis voices found on your system.', true);
                    disableAllControls(); // Keep disabled if no voices found
                    return;
                }

                const defaultOption = document.createElement('option');
                defaultOption.textContent = '-- Select a Voice --';
                defaultOption.value = '';
                voiceSelect.appendChild(defaultOption);

                let defaultVoiceSelected = false;
                // Prioritize Hindi and English voices for default selection if available
                 const preferredLangs = ['hi-IN', 'en-US', 'en-GB'];
                 let selectedOption = null;

                voices.sort((a, b) => a.name.localeCompare(b.name)); // Sort voices alphabetically

                voices.forEach(voice => {
                    const option = document.createElement('option');
                    option.textContent = `${voice.name} (${voice.lang})`;
                    option.setAttribute('data-lang', voice.lang);
                    option.setAttribute('data-name', voice.name);
                    option.value = voice.name;

                     // Check if this voice should be the default selection
                     if (voice.name === previouslySelected) {
                        option.selected = true; // Restore previous selection
                        selectedOption = option;
                     } else if (!selectedOption && voice.default) {
                         option.selected = true; // Browser default
                         selectedOption = option;
                     } else if (!selectedOption && preferredLangs.includes(voice.lang)) {
                         option.selected = true; // First preferred language found
                         selectedOption = option;
                     }

                    voiceSelect.appendChild(option);
                });

                 // Ensure *some* option is selected if no specific condition was met
                if (!selectedOption && voiceSelect.options.length > 1) {
                    // voiceSelect.options[1].selected = true; // Select the first actual voice
                    // Let's keep the "-- Select a Voice --" default selected initially
                }


                updateStatus('Ready', false, 'ready');
                enableCoreControls(); // Enable controls now that voices are loaded
            }

             // Use 'voiceschanged' event if available
             if (synth.onvoiceschanged !== undefined) {
                 console.log("Setting up onvoiceschanged listener.");
                 synth.onvoiceschanged = populateVoiceList;
             }

             // Initial attempt and fallback timer
            updateStatus('Loading voices...', false, 'loading');
            populateVoiceList(); // Call immediately in case voices are already loaded
            // Set a timeout as a fallback for browsers that might not fire voiceschanged promptly/correctly
            voiceLoadTimeout = setTimeout(() => {
                console.warn("Voice load timeout reached. Attempting to populate voices again.");
                populateVoiceList();
             }, 1500); // Wait 1.5 seconds


            // --- Event Listeners ---
            rateSlider.addEventListener('input', () => rateValueSpan.textContent = rateSlider.value);
            pitchSlider.addEventListener('input', () => pitchValueSpan.textContent = pitchSlider.value);
            volumeSlider.addEventListener('input', () => volumeValueSpan.textContent = volumeSlider.value);

            playBtn.addEventListener('click', handlePlay);
            pauseBtn.addEventListener('click', handlePause);
            resum